name: Daily Price Update

# Run every day at midnight EST (5am UTC)
on:
  schedule:
    - cron: '0 5 * * *'  # 5am UTC = 12am EST
  workflow_dispatch:  # Allows manual trigger from GitHub UI

jobs:
  update-prices:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
      
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
      
      - name: Run price update script
        env:
          NEON_DB_URL: ${{ secrets.NEON_DB_URL }}
          SHOPIFY_SHOP_URL: ${{ secrets.SHOPIFY_SHOP_URL }}
          SHOPIFY_ACCESS_TOKEN: ${{ secrets.SHOPIFY_ACCESS_TOKEN }}
          POKEMONTCG_API_URL: ${{ secrets.POKEMONTCG_API_URL }}
          TCG_API_KEY: ${{ secrets.TCG_API_KEY }}
          EMAIL_ENABLED: ${{ secrets.EMAIL_ENABLED }}
          ZOHO_EMAIL: ${{ secrets.ZOHO_EMAIL }}
          ZOHO_APP_PASSWORD: ${{ secrets.ZOHO_APP_PASSWORD }}
          EMAIL_TO: ${{ secrets.EMAIL_TO }}
          USD_TO_CAD: "1.35"
          MARKUP: "1.10"
          SHOPIFY_API_VERSION: "2025-01"
        run: |
          python price_update_ultra_conservative.py
      
      - name: Upload logs (if any)
        if: always()
        uses: actions/upload-artifact@v4

        
        with:
          name: price-update-logs
          path: "*.log"
          if-no-files-found: ignore
